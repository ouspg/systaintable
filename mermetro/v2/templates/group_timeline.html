<!DOCTYPE html>
<html>
<head>
    <title>Mermetro2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='v2_styles.css') }}">
    <script>
        window.templateVars = {
            selectedGroup: '{{ selected_group or "" }}',
            timeline: '{{ timeline or "" }}',
            timestamp: '{{ timestamp or "" }}'
        };
    </script>
    <script type="module" src="{{ url_for('static', filename='v2_script.js') }}"></script>
</head>
<body>
    <div class="header"><h1>Mermetro2</h1></div>
    <div class="controls">
        <div class="control-group">
            <label for="group-selector">Select Group:</label>
            <select id="group-selector"></select>
        </div>
        <div class="control-group">
            <label>Selected:</label>
            <span id="selected-group" class="status">{{ selected_group or 'None' }}</span>
        </div>
        <div class="control-group">
            <label>Last Update:</label>
            <span id="timestamp" class="status">{{ timestamp }}</span>
        </div>
        <button id="filteredButton">Filtered Entries</button>
    </div>

    <div class="timerange-container">
        <input type="date" id="startDate" placeholder="yyyy-mm-dd">
        <label for="startTime">Time:</label>
        <input type="time" id="startTime" value="00:00:00" step="1">

        <label for="endDate">End Date:</label>
        <input type="date" id="endDate" placeholder="yyyy-mm-dd">
        <label for="endTime">Time:</label>
        <input type="time" id="endTime" value="23:59:59" step="1">

        <button id="applyTimeRangeButton">Apply Time Range</button>
        <button id="clearTimeRangeButton">Reset</button>
    </div>

    <div class="diagram-section">
        <div class="section-header">
            <h2>Group Formation Timeline</h2>
            <div class="control-group">
                <label for="direction-btn" style="margin-right:10px;">Swap Direction</label>
                <button id="direction-btn" type="button">Top Down</button>
            </div>
        </div>
        <div class="diagram-container" id="formation-timeline-container">
            {% if timeline %}
            <div class="mermaid">{{ timeline|safe }}</div>
            {% else %}
            <div class="mermaid"></div>
            {% endif %}
        </div>
    </div>
    
    <div class="diagram-section">
        <div class="section-header">
            <h2>Node Relationships</h2>
        </div>
        <div class="diagram-container" id="nodes-container">
            <div class="mermaid" id="nodes-mermaid"></div>
        </div>
    </div>
    
    <div class="diagram-section">
        <div class="section-header">
            <h2>Activity Timeline Heatmap</h2>
        </div>
        <div class="timeline-heatmap-container">
            <div class="heatmap-bar" id="timelineHeatmapBar">
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; font-style: italic;">
                    Loading heatmap data...
                </div>
            </div>
            <div class="heatmap-info">
                <div class="heatmap-range">
                    <strong>Time Range:</strong><br>
                    <span id="heatmapStart">Loading...</span> to <span id="heatmapEnd">Loading...</span>
                </div>
            </div>
            <div id="heatmapStats">
            </div>
        </div>
    </div>
    
    <div id="nodeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">Details</h2>
            <div id="modalContent"></div>
        </div>
    </div>
    
    <div id="groupLogModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="groupLogModalTitle">Group Formation Log</h2>
            <div id="groupLogModalContent"></div>
        </div>
    </div>
</body>
</html>
